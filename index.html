<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Word Ladder — Auto Puzzle</title>
  <style>
    :root { --bg:#0b1020; --card:#141a32; --ink:#e8ebff; --muted:#9aa3c7; --accent:#7aa2ff; --good:#27d17f; --bad:#ff5d73; --warn:#ffb020; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; background: radial-gradient(1200px 800px at 20% 0%, #0f1640, #0b1020); color: var(--ink); }
    header { padding: 18px 20px; display:flex; align-items:center; gap:12px; border-bottom: 1px solid #1c2447; position: sticky; top:0; backdrop-filter: blur(8px); background: rgba(11,16,32,0.6); z-index: 5; }
    header h1 { font-size: 18px; margin:0; letter-spacing: .4px; }
    .tag { font-size:12px; padding:4px 8px; border-radius:999px; background: #20264a; color: var(--muted); border:1px solid #2a3160; }
    main { max-width: 920px; margin: 20px auto; padding: 16px; display:grid; grid-template-columns: 1fr 360px; gap: 18px; }
    @media (max-width: 900px){ main{ grid-template-columns: 1fr; } }

    .card { background: var(--card); border:1px solid #1c2447; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.25); }
    .panel { padding: 16px; }

    .controls { display:flex; flex-wrap:wrap; gap:10px; align-items:center; }
    .controls .row { display:flex; gap:10px; align-items:center; }
    select, button, input[type="text"] { background:#0f1530; border:1px solid #263064; color:var(--ink); padding:10px 12px; border-radius: 12px; font-size: 14px; outline: none; }
    select:focus, button:focus, input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(122,162,255,0.25); }
    button { cursor: pointer; transition: transform .06s ease, background .2s ease; }
    button:hover { background:#0d1228; }
    button:active { transform: translateY(1px); }
    .primary { background: linear-gradient(180deg, #263b8e, #213579); border-color:#2e4ab7; }
    .ghost { background: transparent; }

    .ladder { padding: 14px; display:flex; flex-direction:column; gap: 10px; }
    .rung { display:grid; grid-template-columns: 1fr 36px; align-items:center; gap:8px; padding: 10px; border:1px dashed #2a3160; border-radius: 12px; }
    .rung.fixed { border-style: solid; border-color:#2e4ab7; background: #101637; }
    .rung .idx { width: 28px; height: 28px; display:grid; place-items:center; border-radius: 8px; background:#0e1430; border:1px solid #2a3160; font-size: 12px; color: var(--muted); }

    .wordbox { display:flex; gap:8px; }
    .char { width: 44px; height: 48px; display:grid; place-items:center; border-radius: 10px; font-weight: 700; letter-spacing: 1px; font-size: 22px; text-transform: uppercase; background:#0b112b; border:1px solid #233064; }
    .char.err { border-color: var(--bad); box-shadow: inset 0 0 0 2px rgba(255,93,115,.25); }
    .char.ok  { border-color: var(--good); }
    .rung .msg { font-size: 12px; color: var(--muted); margin-left: 4px; }

    .note { font-size: 13px; color: var(--muted); }
    .hint { color: var(--warn); }

    .sidebar { display:flex; flex-direction:column; gap:12px; }
    .stat { display:flex; align-items:center; justify-content:space-between; padding:12px; border-radius:12px; border:1px solid #22305d; background:#0f1530; }
    .stat b { font-size: 18px; }
    .log { max-height: 260px; overflow:auto; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 12px; padding: 12px; border-radius: 12px; background:#0f1530; border:1px solid #22305d; white-space: pre-wrap; }

    .divider { height:1px; background:#1c2447; margin: 12px 0; }
    footer { max-width:920px; margin: 0 auto 24px; padding: 0 16px; color: var(--muted); font-size: 12px; }
    a { color: var(--accent); }
  </style>
</head>
<body>
  <header>
    <h1>Word Ladder</h1>
    <span class="tag">Auto‑generated puzzles</span>
  </header>

  <main>
    <section class="card">
      <div class="panel">
        <div class="controls" role="region" aria-label="Controls">
          <div class="row">
            <label for="length">Word length</label>
            <select id="length" aria-label="Word length">
              <option value="3">3</option>
              <option value="4" selected>4</option>
              <option value="5">5</option>
            </select>
          </div>
          <div class="row">
            <button id="new" class="primary">New Puzzle</button>
            <button id="hint" class="ghost">Hint</button>
            <button id="giveup" class="ghost">Give Up</button>
          </div>
          <div class="row">
            <span class="note">Type each missing rung; each step must change <b>exactly one letter</b> and be a valid word.</span>
          </div>
        </div>
      </div>
      <div id="ladder" class="ladder" aria-live="polite"></div>
    </section>

    <aside class="sidebar">
      <div class="card panel">
        <div class="stat"><span>Puzzles solved</span><b id="wins">0</b></div>
        <div class="stat"><span>Best streak</span><b id="streak">0</b></div>
        <div class="stat"><span>Current streak</span><b id="cstreak">0</b></div>
      </div>
      <div class="card panel">
        <b>Activity</b>
        <div id="log" class="log" aria-live="polite"></div>
      </div>
      <div class="card panel">
        <b>Options</b>
        <div class="divider"></div>
        <label><input type="checkbox" id="hardmode" /> Hard mode (no hints)</label>
        <p class="note">Hard mode disables hints and forces each guess to be part of <i>some</i> shortest path.</p>
      </div>
    </aside>
  </main>

  <footer>
    Built with vanilla HTML/CSS/JS. Word lists are embedded for offline play. Feel free to expand the dictionary for richer puzzles.
  </footer>

<script>
// --- Small embedded dictionaries (expand as you like) ---
// Keep lists modest for demo. All lowercase.
const WORDS_3 = ["abs","ace","act","add","ado","aft","age","ago","aid","ail","aim","air","alb","ale","all","alt","amp","and","ant","any","ape","app","apt","arc","are","arf","ark","arm","art","ash","ask","asp","ass","ate","awe","awl","axe","aye","bad","bag","ban","bap","bar","bat","bay","bed","beg","bet","bib","bid","big","bin","bio","bit","biz","boa","bob","bog","bop","bot","bow","box","boy","bra","bro","bud","bug","bum","bun","bus","but","buy","bye","cab","cad","cam","can","cap","car","cat","chi","cob","cod","cog","con","coo","cop","cot","cow","cox","coy","cry","cub","cud","cue","cup","cur","cut","dab","dad","dam","dan","day","den","dew","dib","did","die","dig","dim","din","dip","dis","dob","doe","dog","don","dot","dow","dry","dub","dud","due","dug","dun","duo","dye","ear","eat","eau","ebb","eco","eek","eel","egg","ego","eke","elf","elk","elm","emo","emu","end","eon","era","ere","erg","err","eve","ewe","eye”,”fab","fad","fag","fan","far","fat","fax","fay","fed","fen","few","fey","fez","fib","fie","fig","fin","fir","fit","fix","flu","fly","fob","foe","fog","for","fox","fry","fug","fun","fur”,”gab","gad","gag","gal","gap","gay","gel","gem","gen","geo","get","gig","gin","git","gnu","gob","god","goo","got","gov","gum","gun","gut","guv","guy","gym","gyp”,”had","hag","hah","ham","has","hat","hay","heh","hen","her","hew","hex","hey","hic","hid","hie","him","hip","his","hit","hob","hod","hoe","hog","hon","hop","hot","how","hub","hue","hug","hum","hut","ice","icy","ilk","ill","imp","ink","inn","ion","ire","irk","its","ivy","jab","jag","jam","jar","jaw","jay","jet","jib","jig","job","joe","jog","jot","joy","jug","jut”,”keg","ken","key","kid","kin","kip","kit","lab","lad","lag","lam","lap","lav","law","lax","lay","led","lee","leg","let","ley","lib","lid","lie","lip","lit","lob","log","loo","lop","lot","low","lug","luv","lux","mad","mag","man","map","mar","mat","maw","max","may","men","met","mew","mic","mid","mix","mob","mod","mog","mom","moo","mop","mow","mud","mug","mum","mux","nab","nag","nan","nap","nav","nay","net","new","nib","nil","nip","nix","nob","nod","nom","non","nor","not","now","nub","nun","nut","oaf","oak","oar","oat","och","odd","ode","off","oft","ohm","oik","oil","old","one","oof","ooh","opt","orb","ore","our","out","owe","owl","own","oxy","pad","pal","pan","par","pat","paw","pax","pay","pea","pee","peg","pen","pep","per","pet","pew","phi","pic","pie","pig","pin","pip","pit","ply","pod","poo","pop","pot","pox","pre","pro","pry","psi","pub","pud","pug","pun","pup","put","qin","qua”,”rad","rag","raj","ram","ran","rap","rat","raw","ray","red","ref","rep","rev","rex","rho","rib","rid","rig","rim","rip","rob","roc","rod","roe","rot","row","rub","rue","rug","rum","run","rut","rye","sac","sad","sap","sat","saw","sax","say","sea","see","seg","set","sew","sex","she","shy","sic","sim","sin","sip","sir","sis","sit","six","ska","ski","sky","sly","sob","sod","sol","son","sop","sot","sou","sow","soy","soz","spa","spy","sty","sub","sud","sue","sum","sun","sup”,”tab","tad","tag","tan","tap","tar","tat","tau","tax","tea","ted","tee","ten","the","tho","thy","tic","tie","tin","tip","tis","tit","tod","toe","tog","tom","ton","too","top","tor","tot","tow","toy","try","tub","tug","tum","tun","tup","tut","tux","two","uni","urn","use","van","vat","veg","vet","vex","via","vim","vow","vox","wad","wag","wan","war","was","wax","way","web","wed","wee","wet","who","why","wig","win","wit","wiz","woe","wok","won","wow","wry","yak","yam","yap","yaw","yay","yea","yen","yep","yes","yet","yew","yin","yip","yob","yon","you","yuk","yum","zag","zap","zed","zee","zen","zip","zit","zoo"
].filter((v,i,a)=>a.indexOf(v)===i);

const WORDS_4 = ["able","acer","acid","acne","acre","acts","adds","aged","ages","aids","aims","also","alto","anal","andy","anti","apps","aqua","arab","arch","area","arms","army","arts","asks","atom","auto","away","axis","babe","baby","back","bags","bald","ball","band","bang","bank","bare","barn","bars","base","bass","bath","beam","bean","bear","beat","beds","beef","been","beer","bell","belt","bend","bent","best","beta","bias","bids","bike","bill","bind","bird","bite","bits","blah","blog","blow","blue","boat","body","bold","bolt","bomb","bond","bone","boob","book","bool","boom","boot","born","boss","both","bowl","boys","buck","bugs","bulk","bull","burn","bush","busy","butt","buys","buzz","byte","cafe","cage","cake","call","calm","came","camp","cant","cape","caps","carb","card","care","cars","cart","case","cash","cast","cats","cave","cell","cent","char","chat","chef","chip","ciao","cite","city","clan","clay","clip","club","coal","coat","cock","code","coin","cold","come","cook","cool","cope","copy","cord","core","cork","corn","cost","cove","crew","crop","cube","cult","cure","cute","dale","dame","damn","dare","dark","dash","data","date","dawn","dead","deaf","deal","dean","dear","debt","deck","deep","deer","dell","demo","deny","desk","dial","dice","died","dies","diet","dirt","disc","dish","disk","dive","dock","does","doll","dome","done","dont","doom","door","dose","down","drag","draw","drew","drop","drug","drum","dual","duck","dude","duke","dumb","dump","dust","duty","each","earl","earn","ease","east","easy","echo","edge","edit","eggs","else","ends","epic","even","ever","evil","exam","exit","eyed","face","fact","fail","fair","fake","fall","fame","fare","farm","fast","fate","fear","feat","feed","feel","feet","fell","felt","file","fill","film","find","fine","fire","firm","fish","fist","five","flag","flat","flex","flip","flow","flux","foam","fold","folk","font","food","fool","foot","ford","fork","form","fort","foul","four","free","frog","from","fuel","full","fund","funk","gage","gain","gale","game","gang","gate","gave","gear","geek","gene","gets","gift","girl","give","glad","glen","glow","goal","goat","gods","goes","gold","golf","gone","good","gore","goto","grab","gray","grew","grey","grid","grip","grow","gulf","guns","guru","guys","hack","hair","half","hall","halo","hand","hang","hard","hare","harm","hart","hash","hate","have","hawk","head","hear","heat","heel","held","hell","help","herb","here","hero","hide","high","hill","hint","hire","hold","hole","holy","home","hood","hook","hope","horn","hose","host","hour","huge","hung","hunt","hurt","icon","idea","idle","idol","inch","into","iron","isle","item","jack","jade","jail","jazz","jeep","join","joke","jump","junk","jury","just","keen","keep","kept","kick","kill","kind","king","kiss","knee","knew","knit","know","lace","lack","lady","laid","lake","lamb","lamp","land","lane","last","late","lawn","lazy","lead","leaf","lean","left","lens","less","life","lift","like","lime","line","link","lion","list","lite","live","load","loan","lock","logo","lone","long","look","loop","lord","lose","loss","lost","lots","loud","love","luck","lung","made","mail","main","make","male","mall","many","mare","mask","mass","mate","math","matt","meal","mean","meat","meet","mega","memo","menu","mere","mesa","mesh","mess","meta","mice","midi","mike","mild","mile","milk","mill","mime","mind","mine","mini","mint","miss","mode","mold","mono","mood","moon","more","moss","most","move","much","must","myth","nail","name","nano","navy","near","neck","need","neon","nest","news","next","nice","nick","nine","node","none","noon","norm","nose","note","nova","nude","nuke","null","nuts","odds","okay","once","only","onto","oops","open","oral","orgy","ours","oval","oven","over","pace","pack","page","paid","pain","pair","pale","palm","park","part","pass","past","path","peak","peer","pest","pick","pike","pill","pine","ping","pink","pipe","plan","play","plot","plug","plus","poem","poet","pole","poll","polo","poly","pond","pool","poor","pope","pork","port","pose","post","pour","pray","prep","prix","pull","pump","punk","pure","push","quad","quit","quiz","race","rack","rage","raid","rail","rain","rank","rape","rare","rate","read","real","rear","reed","reef","reel","rely","rent","rest","rice","rich","ride","ring","ripe","rise","risk","road","rock","role","roll","roof","room","root","rope","rose","ruby","rule","rush","safe","sage","said","sail","sake","sale","salt","same","sand","sane","sans","save","scan","seal","seat","seed","seek","seem","seen","self","sell","semi","send","sent","sexy","shed","ship","shoe","shop","shot","show","shut","sick","side","sign","silk","sing","sink","site","size","skin","skip","slim","slip","slot","slow","snap","snow","soap","sofa","soft","soil","sold","sole","solo","some","song","soon","sort","soul","soup","spam","span","spin","spot","star","stay","stem","step","stop","stud","such","suck","suit","sure","surf","swap","swim","sync","tail","take","tale","talk","tall","tank","tape","task","taxi","team","tear","tech","teen","tell","temp","tend","tent","term","test","text","than","that","thee","them","then","they","thin","this","thou","thru","thus","tide","tied","tier","ties","tile","till","time","tiny","tire","toil","told","toll","tone","took","tool","tour","town","trap","tray","tree","trek","trim","trio","trip","true","tube","tune","turn","twin","type","ugly","undo","unit","unto","upon","urge","used","user","vary","vast","very","vice","view","visa","void","volt","vote","wage","wait","wake","walk","wall","want","ward","ware","warm","wash","watt","wave","weak","wear","weed","week","well","went","were","west","what","when","whom","wide","wife","wild","will","wind","wine","wing","wire","wise","wish","with","wolf","wood","wool","word","work","worm","worn","wrap","yard","yarn","yeah","year","yoga","your","zero","zinc","zone","zoom"].filter(w=>/^[a-z]{4}$/.test(w)).filter((v,i,a)=>a.indexOf(v)===i);

const WORDS_5 = ["aback","abase","abash","abate","abbey","abbot","abeam","abhor","abide","abled","abode","abort","about","above","abuse","abuzz","abyss","ached","achoo","acing","acorn","acres","acrid","acted","actor","acute","adage","adapt","added","adder","addle","adept","adieu","adios","adlib","admit","adobe","adopt","adore","adorn","adult","aegis","affix","afire","afoot","afore","afoul","after","again","agape","agate","agave","agent","agile","aging","aglow","agony","agree","ahead","aided","ailed","aimed","aired","airer","aisle","alack","alarm","album","alder","alert","algae","alias","alibi","alien","align","alike","alive","allay","alley","allot","allow","alloy","aloft","alone","along","aloof","aloud","alpha","altar","alter","amass","amaze","amber","amble","amend","amigo","amino","amiss","amity","among","amour","amped","ample","amply","amuck","amuse","angel","anger","angle","angry","angst","anise","ankle","annex","annoy","annul","annum","anode","antic","antsy","anvil","aorta","apace","apart","aphid","apian","aping","apnea","apple","apply","apron","aptly","arbor","arced","ardor","arena","argon","argot","argue","arise","armed","armor","aroma","arose","array","arrow","arson","artsy","ascot","ashen","aside","asked","askew","aspen","aspic","assay","asset","aster","astir","astro","atlas","atoll","atone","atria","attic","audio","audit","aught","augur","aural","avail","avert","avian","avoid","await","awake","award","aware","awash","awful","awoke","axial","axing","axiom","axled","azure",
    "babel","bacon","baddy","badge","badly","bagel","baggy","bairn","baize","baked","baker","baldy","baled","baler","balky","bally","balmy","balsa","banal","bandy","banjo","bared","barer","barge","barmy","baron","basal","based","basic","basil","basin","basis","basso","baste","batch","bated","bathe","baton","batty","baulk","bawdy","bayed","bayou","beach","beads","beady","beaky","beano","beard","beast","beaut","bebop","beech","beefy","beery","befit","befog","began","begat","beget","begin","begun","beige","being","belay","belch","belie","belle","belly","below","bench","beret","berry","berth","beryl","beset","besot","bevel","bezel","bible","biddy","bided","bidet","bight","bigot","biked","biker","bilge","billy","bimbo","binge","bingo","biome","biped","bipod","birch","birth","bison","biter","bitsy","bitty","black","blade","blame","bland","blank","blare","blast","blaze","bleak","blear","bleat","bleed","blend","bless","blest","blimp","blind","blini","blink","bliss","blitz","bloat","block","bloke","blond","blood","bloom","blown","blowy","bluer","blues","bluff","blunt","blurb","blurt","blush","board","boast","bobby","boded","bodge","bogey","boggy","bogie","bogus","bombe","boned","bongo","bonny","bonus","booby","booed","boomy","boost","booth","booty","booze","boozy","borax","bored","borer","boric","borne","boron","bosom","boson","bossy","bosun","botch","bough","boule","bound","bowed","bowel","bower","bowie","boxed","boxer","brace","braid","brain","brake","brand","brash","brass","brave","bravo","brawl","brawn","bread","break","bream","breed","brent","briar","bribe","brick","bride","brief","brine","bring","brink","briny","brisk","broad","broil","broke","brood","brook","broom","broth","brown","brung","brunt","brush","brute","buddy","budge","buggy","bugle","build","built","bulge","bulgy","bulky","bully","bumpy","bunch","bunny","burly","burnt","burst","bused","bushy","busty","butch","butte","buxom","buyer","buzzy","bylaw","byway",
    "cabal","cabby","cabin","cable","cacao","cache","cacti","caddy","cadet","cadge","cadre","caged","cagey","cairn","caked","calve","camel","cameo","canal","candy","caned","caner","canny","canoe","canon","canto","caped","caper","capon","carat","cared","cargo","carob","carol","carom","carry","carte","carve","cased","caste","catch","cater","catty","caulk","cause","caved","cavil","cawed","cease","cedar","ceded","cello","chafe","chaff","chain","chair","chalk","champ","chant","chaos","chard","charm","chart","chary","chase","chasm","cheap","cheat","check","cheek","cheep","cheer","chess","chest","chewy","chick","chide","chief","child","chili","chill","chime","chimp","china","chink","chirp","chive","chock","choir","choke","chomp","chord","chore","chose","chuck","chuff","chump","chunk","churn","chute","cider","cigar","cinch","circa","cited","civic","civil","claim","clamp","clang","clank","clash","clasp","class","clean","clear","cleft","clerk","click","cliff","climb","clime","cling","clink","cloak","clock","clomp","clone","close","cloth","cloud","clout","clove","clown","cluck","clued","clump","clung","clunk","coach","coast","cobra","cocky","cocoa","coded","coder","codex","coked","colic","colon","color","combo","comet","comfy","comic","comma","conch","condo","coned","coney","conga","conic","cooed","coped","coper","copse","coral","corer","corgi","corny","corps","coset","costa","couch","cough","could","count","coupe","court","coven","cover","covet","covey","cowed","cower","coyly","coypu","cozen","crack","craft","cramp","crane","crank","crash","crate","crave","crawl","craze","crazy","creak","cream","credo","creed","creek","creep","creme","crepe","crept","cress","crest","crick","cried","crime","crimp","crisp","croak","crock","croft","crone","crony","crook","croon","cross","croup","crowd","crown","crude","cruel","cruet","cruft","crumb","crush","crust","crypt","cubby","cubed","cubic","cubit","cuing","culpa","cumin","cupid","cuppa","cured","curia","curie","curio","curly","curry","curse","curve","curvy","cushy","cuter","cutie","cutup","cycle","cynic",
    "dacha","daddy","daily","dairy","daisy","dally","dance","dandy","dared","dashy","dated","dater","datum","daunt","dazed","dealt","deary","death","debar","debit","debug","debut","decaf","decal","decay","decor","decoy","decry","defer","defog","deify","deign","deity","delay","delta","delve","demon","demur","denim","dense","depot","depth","derby","deter","deuce","devil","dewed","diary","diced","dicey","dicky","dicta","diddy","digit","dilly","dimly","dinar","dined","diner","dingo","dingy","dinky","diode","dippy","direr","dirge","dirty","disco","dishy","ditch","ditto","ditty","divan","dived","diver","divot","divvy","dizzy","djinn","dodge","dodgy","doggy","dogma","doily","doing","dolce","doled","dolly","domed","donna","donor","donut","doozy","doped","dopey","dorky","dosed","doted","dotty","doubt","dough","douse","dowdy","dowel","downy","dowry","dowse","doyen","dozed","dozen","draft","drain","drake","drama","drank","drape","drawl","drawn","dread","dream","drear","dreck","dress","dried","drier","drift","drill","drily","drink","drive","droid","droll","drone","drool","droop","dross","drove","drown","druid","drunk","dryad","dryer","dryly","ducal","ducat","duchy","ducky","dully","dummy","dumpy","dunce","duped","dusky","dusty","dutch","duvet","dwarf","dweeb","dwell","dwelt","dying",
    "eager","eagle","early","earth","eased","easel","eaten","eater","ebbed","ebony","eclat","edema","edged","edict","edify","eerie","egged","egret","eider","eight","eject","eking","eland","elate","elbow","elder","elect","elegy","elfin","elide","elite","elope","elude","email","embed","ember","emcee","emery","emote","empty","enact","ended","endow","endue","enema","enemy","enjoy","ennui","enrol","ensue","enter","entry","envoy","epoch","epoxy","epsom","equal","equip","erase","erect","erode","erred","error","erupt","essay","ester","ether","ethic","ethos","ethyl","etude","evade","event","every","evict","evoke","exact","exalt","excel","exert","exile","exist","expel","extol","extra","exude","exult","eying","eyrie",
    "fable","faced","facet","facie","facto","faddy","faded","fader","faery","faint","fairy","faith","faked","faker","fakir","false","famed","fancy","farce","fared","fatal","fated","fatly","fatty","fatwa","fault","fauna","favor","faxed","fazed","feast","fecal","feces","feign","feint","fella","felon","femme","femur","fence","feral","ferny","ferry","fetal","fetch","feted","fetid","fetus","fever","fewer","fiber","fibre","fiche","field","fiend","fiery","fifth","fifty","fight","filch","filed","filet","filly","filmy","filth","final","finch","fined","fiord","fired","firma","first","firth","fishy","fiver","fixed","fixer","fizzy","fjord","flack","flail","flair","flake","flaky","flame","flank","flare","flash","flask","fleck","fleet","flesh","flick","flier","fling","flint","flirt","float","flock","flood","floor","flora","floss","flour","flout","flown","fluff","fluid","fluke","fluky","flume","flung","flunk","flush","flute","flyby","flyer","foamy","focal","focus","fogey","foggy","foist","folic","folio","folky","folly","fondu","foray","force","forge","forgo","forte","forth","forty","forum","fossa","fosse","found","fount","foxed","foyer","frail","frame","franc","frank","fraud","freak","freed","freer","fresh","friar","fried","frier","frill","frisk","frizz","frock","frond","front","frost","froth","frown","froze","fruit","frump","fryer","fudge","fudgy","fugue","fully","fumed","fungi","funky","funny","furor","furry","fused","fussy","fusty","futon","fuzzy",
    "gable","gaffe","gaily","gamed","gamer","gamey","gamin","gamma","gamut","gangs","gaped","gappy","garde","gassy","gated","gator","gaudy","gauge","gaunt","gauss","gauze","gauzy","gavel","gawky","gayer","gayly","gazed","gecko","geese","genie","genii","genre","genus","geode","gesso","getup","ghost","ghoul","giant","giddy","gimme","gipsy","girly","girth","gismo","given","giver","gizmo","glade","gland","glans","glare","glass","glaze","gleam","glean","glide","glint","glitz","gloat","globe","gloom","glory","gloss","glove","glued","gluey","gluon","glyph","gnarl","gnash","gnome","godly","gofer","going","golem","golly","gonad","goner","gonna","goody","gooey","goofy","goony","goopy","goose","gored","gorge","gorse","gouda","gouge","gourd","gouty","grace","grade","graft","grail","grain","grand","grant","grape","graph","grasp","grass","grate","grave","gravy","graze","great","grebe","greed","greek","green","greet","grief","grift","grill","grime","grimy","grind","gripe","grist","groan","groat","groin","groom","grope","gross","group","grout","grove","growl","grown","gruel","gruff","grump","grunt","guano","guard","guava","guess","guest","guide","guild","guile","guilt","guise","gulag","gulch","gully","gumbo","gummy","gunky","guppy","gushy","gusto","gusty","gutsy","gyppy","gypsy",
    "habit","hades","haiku","hairy","haled","halve","hammy","handy","hanky","happy","hardy","harem","harpy","harry","harsh","haste","hasty","hatch","hated","hater","haunt","haute","haven","havoc","hawed","hazed","hazel","heady","heard","heart","heath","heave","heavy","hedge","hefty","heigh","heist","helix","hello","hence","henge","henna","herby","heron","hertz","hewed","hexed","hexer","hider","hiked","hiker","hilly","hinge","hippo","hippy","hired","hitch","hived","hoagy","hoard","hoary","hobby","hocus","hoist","hokey","hokum","holed","holer","holey","holly","homed","homey","homme","honed","honey","honor","hooch","hooey","hooky","hoped","hoppy","horde","horny","horse","horsy","hosed","hotel","hotly","hound","houri","house","hovel","hover","howdy","hubba","hubby","huffy","huger","hulky","human","humid","humor","humph","humpy","humus","hunch","hunky","hurry","husky","hussy","hutch","hydra","hydro","hyena","hymen","hyped","hyper",
    "ichor","icier","icily","icing","ideal","idiom","idiot","idled","idyll","igloo","iliac","ilium","image","imago","imbed","imbue","impel","imply","inane","inapt","incur","index","indie","inept","inert","infer","infix","infra","ingot","inked","inlay","inlet","inner","input","inset","inter","intra","intro","inure","ionic","irate","irked","irony","islet","issue","itchy","ivied","ivory",
    "jaded","jammy","japan","jaunt","jawed","jazzy","jello","jelly","jenny","jerky","jerry","jetty","jewel","jibed","jiffs","jiffy","jihad","jimmy","jingo","jived","joint","joist","joked","joker","jolly","joule","joust","jowly","judge","juice","juicy","julep","jumbo","jumpy","junky","junta","juror",
    "kappa","kaput","karat","karma","kayak","kazoo","kebab","kefir","keyed","khaki","kiddo","kinda","kinky","kiosk","kitty","klunk","klutz","knack","knave","knead","kneed","kneel","knell","knelt","knife","knock","knoll","known","knurl","koala","kooky","kopek","kraut","krill","krona","kudos","kudzu","kulak","kyrie",
    "label","labia","labor","laced","lacey","laden","ladle","lager","laird","laity","lamed","lance","lanky","lapel","lapis","lapse","larch","lardy","large","largo","larva","laser","lasso","latch","later","latex","lathe","latin","laude","laugh","laved","laxer","layer","layup","lazed","leach","leafy","leaky","leant","leapt","learn","lease","leash","least","leave","ledge","leech","leery","lefty","legal","leggy","legit","lemma","lemon","lemur","lento","leper","letup","levee","level","lever","libel","libra","liege","lifer","light","liked","liken","lilac","limbo","limed","limey","limit","lined","linen","liner","lingo","lions","lipid","lippy","lithe","litre","lived","liven","liver","livid","livre","llama","loamy","loath","lobby","lobed","local","locus","lodge","lofty","logic","login","lolly","loner","loony","loopy","loose","loped","lordy","lorry","loser","lossy","lotto","lotus","louse","lousy","loved","lover","lowed","lower","lowly","loyal","lucid","lucky","lucre","lumen","lumpy","lunar","lunch","lunge","lupus","lurch","lured","lurid","lusty","lycra","lying","lymph","lynch","lyric",
    "macaw","macho","macro","madam","madly","mafia","magic","magma","magus","maize","major","maker","malty","mambo","mamma","mammy","maned","mange","mango","mangy","mania","manic","manly","manna","manor","manta","maple","march","maria","marry","marsh","mason","masse","match","mated","mater","matey","matte","mauve","maxim","maybe","mayor","mealy","meant","meaty","mecca","medal","media","medic","melba","melee","melon","mercy","merge","merit","merry","meson","messy","metal","meted","meter","metre","metro","mewed","mezzo","miaow","micro","midst","might","miked","mikes","milky","mimed","mimic","mince","mined","miner","minim","minor","minus","mired","mirth","miser","missy","misty","miter","mitre","mixed","mixer","mixup","mocha","modal","model","modem","modus","mogul","moist","molar","moldy","molto","mommy","mondo","money","monic","monte","month","mooch","moody","mooed","moola","moony","moose","moped","moral","moray","moron","morph","mosey","mossy","motel","motet","mothy","motif","motor","motto","mould","moult","mound","mount","mourn","mouse","mousy","mouth","moved","movie","mowed","mower","mucky","mucus","muddy","mufti","muggy","mulch","mumbo","mummy","munch","mural","murky","mused","mushy","music","musky","musty","muted","myrrh",
    "nabob","nacho","nadir","naive","naked","named","namer","nanny","nappy","narco","nasal","nasty","natal","natty","naval","navel","neath","needy","neigh","nerdy","nerve","nervy","never","newel","newer","newly","nexus","nicer","niche","niece","nifty","night","nihil","ninja","ninny","ninth","nippy","nitro","nitty","nixed","noble","nobly","nodal","noddy","noire","noise","noisy","nomad","noose","north","nosed","nosey","notch","noted","novel","nudge","nudie","nuked","nurse","nutty","nylon","nymph",
    "oaken","oasis","obese","occur","ocean","ocher","ochre","octal","octet","odder","oddly","odium","odour","offal","offed","offer","often","ogled","oiled","oiler","okapi","olden","older","oldie","olive","omega","onion","onset","oodle","oomph","oozed","opera","opine","opium","opted","optic","orate","orbed","orbit","order","organ","other","otter","ought","ouija","ounce","outdo","outer","outgo","ovary","ovate","overt","ovoid","owing","owned","owner","oxbow","oxide","ozone",
    "paced","pacer","padre","paean","pagan","paged","pager","paint","paled","paler","pally","palsy","panda","paned","panel","panic","pansy","papal","paper","parch","pared","parer","parka","parry","parse","party","passe","pasta","paste","pasty","patch","pater","patio","patsy","patty","pause","paved","pawed","payee","peace","peach","peaky","pearl","pease","peaty","pecan","pedal","peeve","penal","pence","penny","peony","perch","peril","perky","pesky","pesos","pesto","petal","peter","petit","petri","petty","phage","phase","phial","phlox","phone","phony","photo","phyla","piano","picky","piece","pieta","piety","piggy","pigmy","pilau","piled","pilot","pinch","pined","piney","pinky","pinto","pinup","pious","piped","piper","pique","pitch","pithy","piton","pivot","pixel","pixie","pizza","place","plaid","plain","plait","plane","plank","plant","plate","plaza","plead","pleat","plied","plink","plonk","pluck","plumb","plume","plump","plumy","plunk","plush","plyer","poach","podgy","podia","poesy","point","poise","poked","poker","pokey","polar","poled","polio","polka","polyp","pooch","pooey","poppy","porch","pored","porky","posed","poser","poset","posit","posse","poste","potty","pouch","pound","power","poxed","prank","prawn","preen","press","prest","price","prick","pride","pried","prima","prime","primo","primp","prink","print","prior","prise","prism","privy","prize","probe","promo","prone","prong","proof","prose","proud","prove","prowl","proxy","prude","prune","pryer","psalm","pseud","psych","pubic","pubis","pudgy","puffy","puked","pukes","pukka","pulpy","pulse","punch","pupae","pupal","pupil","puppy","puree","purer","purge","purse","pushy","pussy","putty","pygmy","pylon",
    "quack","quaff","quail","quake","qualm","quark","quart","quash","quasi","queen","queer","quell","query","quest","queue","quick","quiet","quiff","quill","quilt","quire","quirk","quite","quoit","quota","quote","quoth",
    "rabbi","rabid","raced","racer","radar","radii","radio","radon","raged","rainy","raise","rajah","raked","rally","ranch","randy","range","rangy","rapid","rarer","raspy","rated","ratio","ratty","raved","ravel","raven","raver","rawer","rawly","rayon","razed","razer","razor","reach","react","ready","realm","rearm","rebar","rebel","rebus","rebut","recap","recta","recur","recut","redly","redux","reedy","reeky","reeve","refer","refit","refix","refry","regal","rehab","reign","relax","relay","relic","remap","remit","remix","renal","renew","repay","repel","reply","repro","rerun","reset","resew","resin","retch","retro","retry","reuse","revel","revue","rheum","rhino","rhyme","rider","ridge","ridgy","rifer","rifle","right","rigid","rigor","riled","rille","rimed","rinse","ripen","riper","risen","riser","risky","ritzy","rival","riven","river","rivet","roach","roast","robed","robin","robot","rocky","rodeo","rogue","roman","rondo","rooky","roomy","roost","rooty","roped","rosin","rotor","rouge","rough","round","rouse","roust","route","roved","rover","rowan","rowdy","rowed","rower","royal","ruble","ruddy","ruder","rugby","ruing","ruled","ruler","rumba","rummy","rumor","runic","runny","runty","rupee","rural","rusty",
    "saber","sable","sabre","sadly","safer","sahib","saint","salad","sally","salon","salsa","salty","salve","salvo","samba","sandy","saner","sappy","sarge","sassy","sated","satin","satyr","sauce","saucy","sauna","saute","saved","saver","savor","savvy","sawed","sawer","sayer","scald","scale","scalp","scaly","scamp","scant","scare","scarf","scarp","scary","scene","scent","schwa","scion","scoff","scold","scone","scoop","scoot","scope","score","scorn","scour","scout","scowl","scram","scrap","screw","scrim","scrip","scrub","scrum","scuba","scuff","scull","sebum","sedan","sedge","seedy","segue","seize","sense","sepal","sepia","sepoy","serge","serif","serum","serve","servo","setup","seven","sever","sewed","sewer","shack","shade","shady","shaft","shake","shaky","shale","shall","shalt","shame","shank","shape","shard","share","shark","sharp","shave","shawl","sheaf","shear","sheen","sheep","sheer","sheet","sheik","shelf","shell","shied","shier","shift","shill","shine","shiny","shire","shirk","shirt","shish","shoal","shock","shoed","shone","shook","shoot","shore","shorn","short","shout","shove","shown","showy","shred","shrew","shrub","shrug","shuck","shunt","shush","shyer","shyly","sibyl","sicko","sided","sidle","siege","sieve","sight","sigma","silky","sills","silly","silty","since","sinew","singe","sinus","sired","siren","sissy","sitar","sited","sixth","sixty","sized","skate","skeet","skied","skier","skiff","skill","skimp","skint","skirt","skulk","skull","skunk","skyed","slack","slain","slake","slang","slant","slash","slate","slats","slave","sleek","sleep","sleet","slept","slice","slick","slide","slier","slily","slime","slimy","sling","slink","sloop","slope","slosh","sloth","slump","slung","slunk","slurp","slush","slyer","slyly","smack","small","smart","smash","smear","smell","smelt","smile","smirk","smite","smith","smock","smoke","smoky","smote","smurf","snack","snafu","snail","snake","snaky","snare","snark","snarl","sneak","sneer","snide","sniff","snipe","snood","snoop","snore","snort","snout","snowy","snuff","soapy","sober","softy","soggy","solar","soled","solid","solve","sonar","sonic","sonny","sooth","sooty","soppy","sorer","sorry","sound","soupy","south","sowed","sower","space","spacy","spade","spake","spank","spare","spark","spasm","spate","spawn","speak","spear","speck","speed","spell","spelt","spend","spent","sperm","spice","spicy","spied","spiel","spike","spiky","spill","spilt","spine","spiny","spire","spite","splat","splay","split","spoil","spoke","spoof","spook","spool","spoon","spoor","spore","sport","spout","sprat","spray","spree","sprig","sprog","spume","spumy","spunk","spurn","spurs","spurt","squab","squad","squat","squaw","squib","squid","stack","staff","stage","stagy","staid","stain","stair","stake","stale","stalk","stall","stamp","stand","stank","stare","stark","start","stash","state","stave","stead","steak","steal","steam","steed","steel","steep","steer","stein","stele","stern","stick","stied","stiff","stile","still","stilt","sting","stink","stint","stoat","stock","stoic","stoke","stole","stoma","stomp","stone","stony","stood","stool","stoop","store","stork","storm","story","stout","stove","strap","straw","stray","strep","strew","strip","strop","strum","strut","stuck","study","stuff","stump","stung","stunk","stunt","style","styli","suave","suede","sugar","suing","suite","sulky","sully","sumac","summa","sunny","sunup","super","surer","surge","surly","sushi","swain","swami","swamp","swank","sward","swarm","swart","swash","swath","swear","sweat","swede","sweep","sweet","swell","swept","swift","swill","swine","swing","swipe","swirl","swish","swiss","swoon","swoop","sword","swore","sworn","swung","synod","syrup",
    "tabby","table","taboo","tabor","tacit","tacky","taffy","taint","taken","taker","talky","tally","talon","tamed","tamer","tango","tangy","taped","taper","tapir","tardy","tarot","tarry","taste","tasty","tatty","taunt","taupe","tawny","taxed","teach","teary","tease","techy","teddy","teeny","teeth","telex","telly","tempo","tempt","tench","tenet","tenon","tenor","tense","tenth","tepee","tepid","terce","terra","terry","terse","testy","tetra","texas","thane","thank","theft","their","theme","there","therm","these","theta","thick","thief","thigh","thine","thing","think","third","thong","thorn","those","three","threw","throb","throw","thrum","thumb","thump","thunk","thyme","tiara","tibia","tidal","tided","tiger","tight","tilde","tiled","tiler","timed","timer","timid","tinge","tinny","tippy","tipsy","tired","titan","tithe","title","tizzy","toady","toast","today","toddy","toked","token","toker","tommy","tonal","toned","toner","tonic","tooth","topaz","topic","toque","torah","torch","torso","torte","torus","total","toted","totem","touch","tough","towed","towel","tower","toxic","toxin","toyed","trace","track","tract","trade","trail","train","trait","tramp","trash","trawl","tread","treat","treed","trend","tress","triad","trial","tribe","trice","trick","tried","trier","trike","trill","tripe","trite","troll","troop","troth","trout","trove","truce","truck","truer","truly","trump","trunk","truss","trust","truth","tryst","tubal","tubby","tubed","tuber","tufty","tulip","tulle","tummy","tumor","tuned","tuner","tunic","tuple","turbo","tusky","tutor","tutti","twain","twang","tweak","tweed","tweet","twerp","twice","twill","twine","twink","twiny","twirl","twist","twixt","tying","typed",
    "udder","ulcer","ulnar","ultra","umber","umbra","umpty","unbox","uncle","uncut","under","undid","undue","unfed","unfit","unify","union","unite","unity","unlit","unmet","untie","until","unwed","unzip","upend","upped","upper","upset","urban","urged","urine","usage","usher","using","usual","usurp","usury","utero","utter","uvula",
    "vague","valet","valid","valor","value","valve","vaned","vapid","vapor","vault","vaunt","vegan","veiny","veldt","venal","venom","venue","verge","verse","verso","verve","vexed","viand","vicar","video","vigil","vigor","viler","villa","ville","vined","vinyl","viola","viper","viral","virus","visit","visor","vista","vitae","vital","vitro","vivid","vixen","vizor","vocab","vocal","vodka","vogue","voice","voila","voile","vomit","voted","voter","vouch","vowed","vowel","vower","vroom","vulva","vying",
    "wacko","wacky","waded","wader","wafer","waged","wager","wagon","wahoo","waist","waive","waked","waken","waltz","waned","wanly","warty","washy","waspy","waste","watch","water","waved","waver","waxed","waxen","weald","weary","weave","wedge","wedgy","weedy","weeny","weepy","weigh","weird","welch","welsh","wench","wetly","whack","whale","wharf","wheat","wheel","whelk","whelm","whelp","where","which","whiff","while","whine","whiny","whirl","whirr","whisk","whist","white","whizz","whole","whomp","whoop","whorl","whose","widen","wider","widow","width","wield","wimpy","wince","winch","windy","wined","winey","wiped","wiper","wired","wiser","wispy","witch","witty","woken","woman","women","wonky","woody","wooed","wooer","wooly","woosh","woozy","wordy","world","wormy","worry","worse","worst","worth","would","wound","woven","wowed","wrack","wrath","wreak","wreck","wrest","wring","wrist","write","wrong","wrote","wroth","wrung","wryly","wurst",
    "xenon","xerox",
    "yacht","yahoo","yawed","yearn","yeast","yield","yobbo","yodel","yogic","yoked","yokel","young","youth","yucca","yucky","yummy",
    "zappy","zebra","zesty","zilch","zingy","zippy","zloty","zonal","zoned"
].filter(w=>/^[a-z]{5}$/.test(w)).filter((v,i,a)=>a.indexOf(v)===i);

const DICTS = {3:WORDS_3, 4:WORDS_4, 5:WORDS_5};

// --- Utility functions ---
const differByOne = (a,b) => {
  if (a.length !== b.length) return false;
  let diff = 0; for (let i=0;i<a.length;i++){ if (a[i]!==b[i]) diff++; if (diff>1) return false; }
  return diff===1;
}

function neighbors(word, set){
  const out = [];
  for (const w of set){ if (w!==word && differByOne(w, word)) out.push(w); }
  return out;
}

function bfsShortestPath(start, goal, set){
  if (start===goal) return [start];
  const q = [start];
  const prev = new Map();
  const seen = new Set([start]);
  while(q.length){
    const cur = q.shift();
    for(const nb of neighbors(cur,set)){
      if (seen.has(nb)) continue;
      seen.add(nb); prev.set(nb, cur); q.push(nb);
      if (nb===goal){ // reconstruct
        const path = [goal];
        let x = goal; while(prev.has(x)){ x = prev.get(x); path.push(x); if (x===start) break; }
        return path.reverse();
      }
    }
  }
  return null;
}

// Choose a random valid puzzle (start -> goal with a path)
function randomPuzzle(len){
  const dict = DICTS[len];
  const set = new Set(dict);
  for (let tries=0; tries<500; tries++){
    const start = dict[Math.floor(Math.random()*dict.length)];
    let goal = dict[Math.floor(Math.random()*dict.length)];
    if (start===goal) continue;
    const path = bfsShortestPath(start, goal, set);
    if (path && path.length>=3){
      return { start, goal, path };
    }
  }
  return null;
}

// --- Game State ---
let game = {
  length: 4,
  start: '',
  goal: '',
  solution: [],
  guesses: [],
  won: false,
  hard: false,
};

const $ladder = document.getElementById('ladder');
const $log = document.getElementById('log');
const $wins = document.getElementById('wins');
const $streak = document.getElementById('streak');
const $cstreak = document.getElementById('cstreak');

const stats = JSON.parse(localStorage.getItem('wl_stats')||'{"wins":0,"streak":0,"cstreak":0}');
updateStats();

function log(msg){ const t = new Date().toLocaleTimeString(); $log.textContent = `[${t}] ${msg}\n` + $log.textContent; }

function newPuzzle(len = game.length){
  const p = randomPuzzle(len);
  if (!p){ alert('Could not find a puzzle with current dictionary. Try another length or extend the word list.'); return; }
  game.length = len; game.start=p.start; game.goal=p.goal; game.solution=p.path; game.guesses = Array(p.path.length).fill(''); game.guesses[0]=p.start; game.guesses[game.guesses.length-1]=p.goal; game.won=false; render();
  log(`New puzzle (${len}-letter): ${p.start.toUpperCase()} → ${p.goal.toUpperCase()} (rungs: ${p.path.length})`);
}

function render(){
  $ladder.innerHTML = '';
  const steps = game.solution.length;
  for (let i=0; i<steps; i++){
    const fixed = (i===0 || i===steps-1) || (game.guesses[i] && game.guesses[i]===game.solution[i]);
    const rung = document.createElement('div'); rung.className = 'rung'+(fixed?' fixed':'');

    const idx = document.createElement('div'); idx.className='idx'; idx.textContent=(i+1);
    const wordbox = document.createElement('div'); wordbox.className='wordbox';

    const msg = document.createElement('div'); msg.className='msg';

    const word = (i===0)?game.start:(i===steps-1)?game.goal:game.guesses[i]||'';

    const inputs = [];
    for (let c=0;c<game.length;c++){
      const span = document.createElement('div'); span.className='char'; span.setAttribute('role','textbox'); span.setAttribute('aria-label',`Letter ${c+1}`);
      span.contentEditable = (!fixed).toString();
      span.textContent = word[c]?word[c].toUpperCase():'';
      span.addEventListener('input', () => {
        // sanitize to a single A-Z char
        let t = span.textContent.replace(/[^a-zA-Z]/g,'').slice(-1).toLowerCase();
        span.textContent = t.toUpperCase(); placeCaretAtEnd(span);
        captureWord();
      });
      span.addEventListener('keydown', (e)=>{
        if (e.key==='Enter') { e.preventDefault(); focusNext(inputs, span); }
        if (e.key==='Backspace' && !span.textContent && c>0){ e.preventDefault(); inputs[c-1].focus(); }
        if (/^[a-zA-Z]$/.test(e.key) && span.textContent){ // overwrite moves forward
          setTimeout(()=>{ if(c<inputs.length-1) inputs[c+1].focus(); },0);
        }
        if (e.key==='ArrowLeft' && c>0){ e.preventDefault(); inputs[c-1].focus(); }
        if (e.key==='ArrowRight' && c<inputs.length-1){ e.preventDefault(); inputs[c+1].focus(); }
      });
      inputs.push(span); wordbox.appendChild(span);
    }

    function captureWord(){
      const typed = inputs.map(x=>x.textContent.toLowerCase()).join('');
      if (typed.length===game.length){ game.guesses[i]=typed; }
      validate(i, inputs, msg);
      checkWin();
    }

    rung.appendChild(wordbox);
    rung.appendChild(idx);
    rung.appendChild(msg);
    $ladder.appendChild(rung);

    // Initial validation display
    validate(i, inputs, msg);
  }
}

function validate(i, inputs, msgEl){
  const steps = game.solution.length;
  const word = (i===0)?game.start:(i===steps-1)?game.goal:game.guesses[i]||'';
  const dict = new Set(DICTS[game.length]);

  // Clear classes
  for (const el of inputs) el.classList.remove('ok','err');

  if (i===0 || i===steps-1){ msgEl.textContent = (i===0?'Start word':'Goal word'); return; }

  if (word.length!==game.length){ msgEl.textContent=''; return; }

  if (!dict.has(word)){
    for (const el of inputs) el.classList.add('err');
    msgEl.textContent = 'Not in dictionary';
    return;
  }

  // adjacency checks
  const prev = game.guesses[i-1]||game.start;
  const next = game.guesses[i+1]||game.goal;
  const okPrev = differByOne(prev, word);
  const okNext = differByOne(word, next);

  if (!okPrev){ for (const el of inputs) el.classList.add('err'); msgEl.textContent='Must differ by 1 from previous'; return; }
  if (game.hard && !isOnSomeShortestPath(i, word)){
    for (const el of inputs) el.classList.add('err'); msgEl.textContent='Hard mode: keep to a shortest path'; return;
  }

  for (const el of inputs) el.classList.add('ok');
  msgEl.textContent = okNext ? 'Good!' : 'Looks good so far';
}

function isOnSomeShortestPath(i, word){
  // In hard mode, require that from guesses[i-1] to goal via `word` is still shortest
  const dict = new Set(DICTS[game.length]);
  const fromPrev = bfsShortestPath(game.guesses[i-1]||game.start, game.goal, dict);
  const viaWordA = bfsShortestPath(game.guesses[i-1]||game.start, word, dict);
  const viaWordB = bfsShortestPath(word, game.goal, dict);
  if (!fromPrev || !viaWordA || !viaWordB) return false;
  return (viaWordA.length + viaWordB.length - 1) === fromPrev.length; // -1 to not double-count `word`
}

function checkWin(){
  const done = game.guesses.every((w, idx) => {
    if (idx===0) return w===game.start; if (idx===game.guesses.length-1) return w===game.goal;
    return w && /^[a-z]{1,}$/.test(w) && w.length===game.length;
  });
  if (!done || game.won) return;

  // validate each step is one-letter change and in dict
  const dict = new Set(DICTS[game.length]);
  for (let i=1;i<game.guesses.length;i++){
    const a = game.guesses[i-1]; const b = game.guesses[i];
    if (!differByOne(a,b) || !dict.has(b)) return; // invalid sequence
  }

  game.won = true;
  stats.wins++; stats.cstreak++; stats.streak = Math.max(stats.streak, stats.cstreak);
  persistStats(); updateStats();
  log(`Solved! Path: ${game.guesses.map(w=>w.toUpperCase()).join(' → ')}`);
  setTimeout(()=>{ alert('Great job! You completed the ladder.'); }, 10);
}

function placeCaretAtEnd(el){
  const range = document.createRange(); range.selectNodeContents(el); range.collapse(false);
  const sel = window.getSelection(); sel.removeAllRanges(); sel.addRange(range);
}

function focusNext(inputs, current){
  const idx = inputs.indexOf(current);
  if (idx < inputs.length-1) inputs[idx+1].focus();
  else {
    // move to the next rung's first editable cell
    const rings = Array.from(document.querySelectorAll('.rung'));
    const my = current.closest('.rung'); const i = rings.indexOf(my);
    for (let j=i+1;j<rings.length;j++){
      const edit = rings[j].querySelector('.char[contenteditable="true"]');
      if (edit){ edit.focus(); return; }
    }
  }
}

function giveHint(){
  if (game.hard) { alert('Hints are disabled in Hard mode.'); return; }
  const idx = game.guesses.findIndex((w,i)=> (i>0 && i<game.guesses.length-1 && w!==game.solution[i]));
  if (idx === -1) return;
  game.guesses[idx] = game.solution[idx];
  render();
  log(`Hint: filled rung ${idx+1} with ${game.solution[idx].toUpperCase()}`);
}

function giveUp(){
  if (!confirm('Reveal the solution?')) return;
  game.guesses = [...game.solution];
  game.won = true; // treat as finished, but do not add to streak
  stats.cstreak = 0; persistStats(); updateStats();
  render(); log(`Solution revealed: ${game.solution.map(w=>w.toUpperCase()).join(' → ')}`);
}

function persistStats(){ localStorage.setItem('wl_stats', JSON.stringify(stats)); }
function updateStats(){ $wins.textContent = stats.wins; $streak.textContent = stats.streak; $cstreak.textContent = stats.cstreak; }

// --- Wire up controls ---
const $len = document.getElementById('length');
const $new = document.getElementById('new');
const $hint = document.getElementById('hint');
const $giveup = document.getElementById('giveup');
const $hard = document.getElementById('hardmode');

$len.addEventListener('change', () => { newPuzzle(parseInt($len.value,10)); });
$new.addEventListener('click', () => { newPuzzle(parseInt($len.value,10)); });
$hint.addEventListener('click', giveHint);
$giveup.addEventListener('click', giveUp);
$hard.addEventListener('change', () => { game.hard = $hard.checked; log(`Hard mode ${game.hard? 'enabled':'disabled'}`); render(); });

// Boot
newPuzzle(4);
</script>
</body>
</html>
